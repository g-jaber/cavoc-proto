let x = ref 0 in
fun f -> x := 0; f(); x:=1; f (); !x+1

(*
{<[cc1](fun f -> l0 := 0 ; f () ; l0 := 1 ; f () ; (!l0+1)) (ff1) | ℓ0↪0 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_14, 
 <[cc1]() ; l0 := 1 ; (ff1) () ; (!l0+1) | ℓ0↪0 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_10, 
 <[cc1]() ; (!l0+1) | ℓ0↪0 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_8, 
 <[cc1]() ; (!l0+1) | ℓ0↪1 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_6, 
 <[cc1]() ; l0 := 1 ; (ff1) () ; (!l0+1) | ℓ0↪1 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_4, 
 <[cc1](fun f -> l0 := 0 ; f () ; l0 := 1 ; f () ; (!l0+1)) (ff1) | ℓ0↪1 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_2, 
 <[cc0]let x = ref_undef 0 in fun f -> x := 0 ; f () ; x := 1 ; f () ; (!x+1) | ε | cc0::¬(Unit->Unit)->Int>_0
}

{<cc4 => cont([cc1]• ; (!l0+1)) | ℓ0::Int | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int | cc4::¬Unit>_11, 
 <ε | ℓ0::Int | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int | ε>_9, 
 <ε | ℓ0::Int | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int | ε>_7, 
 <cc3 => cont([cc1]• ; (!l0+1)) | ℓ0::Int | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int | cc3::¬Unit>_5, 
 <cc2 => cont([cc1]• ; l0 := 1 ; (ff1) () ; (!l0+1)) | ℓ0::Int | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int | cc2::¬Unit>_3, 
 <ff0 => fun f -> l0 := 0 ; f () ; l0 := 1 ; f () ; (!l0+1) | ℓ0::Int | cc0::¬(Unit->Unit)->Int | ff0::(Unit->Unit)->Int>_1}


{14-> Boom, 1 -O ff0((ff1,cc1))-> 14, 11 -O cc4(())-> 8, 11 -O cc4(())-> 6, 10 -P ff1(((),cc4))-> 11, 3 -O cc2(())-> 10, 8 -P cc1(1)-> 9, 5 -O cc3(())-> 8, 6 -P cc1(2)-> 7, 5 -O cc3(())-> 6, 4 -P ff1(((),cc3))-> 5, 3 -O cc2(())-> 4, 2 -P ff1(((),cc2))-> 3, 1 -O ff0((ff1,cc1))-> 2, 0 -P cc0(ff0)-> 1}

*)

(*

{<[cc1](fun f -> l0 := 0 ; f () ; l0 := 1 ; f () ; (!l0+1)) (ff1) | ℓ0↪0 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_14, 
 <[cc1]() ; l0 := 1 ; (ff1) () ; (!l0+1) | ℓ0↪0 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_10, 
 <[cc1]() ; (!l0+1) | ℓ0↪0 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_8, 
 <[cc1]() ; (!l0+1) | ℓ0↪1 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_6,
 <[cc1]() ; l0 := 1 ; (ff1) () ; (!l0+1) | ℓ0↪1 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_4, 
 <[cc1](fun f -> l0 := 0 ; f () ; l0 := 1 ; f () ; (!l0+1)) (ff1) | ℓ0↪1 | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int>_2, 
 <[cc0]let x = ref_undef 0 in fun f -> x := 0 ; f () ; x := 1 ; f () ; (!x+1) | ε | cc0::¬(Unit->Unit)->Int>_0
}
{<cc5 => cont([cc1]• ; l0 := 1 ; (ff1) () ; (!l0+1)) | ℓ0::Int | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int | cc5::¬Unit>_15, 
 <cc4 => cont([cc1]• ; (!l0+1)) | ℓ0::Int | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int | cc4::¬Unit>_11, 
 <ε | ℓ0::Int | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int | ε>_9,
  <ε | ℓ0::Int | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int | ε>_7, 
  <cc3 => cont([cc1]• ; (!l0+1)) | ℓ0::Int | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int | cc3::¬Unit>_5, 
  <cc2 => cont([cc1]• ; l0 := 1 ; (ff1) () ; (!l0+1)) | ℓ0::Int | ff1::Unit->Unit, cc1::¬Int, cc0::¬(Unit->Unit)->Int | cc2::¬Unit>_3, 
  <ff0 => fun f -> l0 := 0 ; f () ; l0 := 1 ; f () ; (!l0+1) | ℓ0::Int | cc0::¬(Unit->Unit)->Int | ff0::(Unit->Unit)->Int>_1
}
{15 -O cc5(())-> 10, 15 -O cc5(())-> 4, 14 -P ff1(((),cc5))-> 15, 1 -O ff0((ff1,cc1))-> 14, 11 -O cc4(())-> 8, 11 -O cc4(())-> 6, 
 10 -P ff1(((),cc4))-> 11, 3 -O cc2(())-> 10, 8 -P cc1(1)-> 9, 5 -O cc3(())-> 8, 6 -P cc1(2)-> 7, 5 -O cc3(())-> 6, 4 -P ff1(((),cc3))-> 5, 
 3 -O cc2(())-> 4, 2 -P ff1(((),cc2))-> 3, 1 -O ff0((ff1,cc1))-> 2, 0 -P cc0(ff0)-> 1}
 *)